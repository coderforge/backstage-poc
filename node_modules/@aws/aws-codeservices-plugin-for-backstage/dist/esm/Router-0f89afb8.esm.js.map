{"version":3,"file":"Router-0f89afb8.esm.js","sources":["../../src/hooks/useCodePipelineExecutions.ts","../../src/components/CodePipelineExecutionsTable/CodePipelineExecutionsTable.tsx","../../src/components/CodePipelineContent/CodePipelineContent.tsx","../../src/components/Router.tsx"],"sourcesContent":["/**\n * Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\").\n * You may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *     http://www.apache.org/licenses/LICENSE-2.0\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useAsyncRetry } from \"react-use\";\nimport { useApi } from \"@backstage/core-plugin-api\";\nimport { PipelineExecutionSummary } from \"@aws-sdk/client-codepipeline\";\nimport { awsCodePipelineApiRef } from \"../api/AwsCodePipelineApi\";\n\nexport function useCodePipelineExecutions(arn: string) {\n  const api = useApi(awsCodePipelineApiRef);\n\n  const {\n    loading,\n    value: pipelineRunsSummaries,\n    error,\n    retry,\n  } = useAsyncRetry<PipelineExecutionSummary[] | undefined>(async () => {\n    return await api.listPipelineExecutions({ arn });\n  }, []);\n\n  return { loading, pipelineRunsSummaries, error, retry } as const;\n}\n","/**\n * Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\").\n * You may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *     http://www.apache.org/licenses/LICENSE-2.0\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from \"react\";\nimport { Box, Typography, Link } from \"@material-ui/core\";\nimport RetryIcon from \"@material-ui/icons/Replay\";\nimport { Table, SubvalueCell } from \"@backstage/core-components\";\nimport { PipelineExecutionSummary } from \"@aws-sdk/client-codepipeline\";\nimport { Entity } from \"@backstage/catalog-model\";\nimport { formatTime, getCodePipelineArnFromEntity } from \"../../utils\";\nimport { PipelineStageStatus } from \"../PipelineStageStatus\";\nimport { useCodePipelineExecutions } from \"../../hooks\";\n\nconst renderTrigger = (\n  row: Partial<PipelineExecutionSummary>\n): React.ReactNode => {\n  if (row.sourceRevisions === undefined) {\n    return (\n      <Typography variant=\"body2\" noWrap>\n        -\n      </Typography>\n    );\n  }\n\n  let commitMessage = \"\";\n\n  if (row.sourceRevisions.length > 0) {\n    const sourceRevision = row.sourceRevisions[0];\n\n    if (sourceRevision.revisionSummary) {\n      switch (sourceRevision.actionName) {\n        case \"SourceAction\":\n          commitMessage = sourceRevision.revisionSummary || \"\";\n          break;\n        case \"Source\":\n          commitMessage = sourceRevision.revisionSummary || \"\";\n          break;\n        case \"Checkout\": {\n          const summary = JSON.parse(sourceRevision.revisionSummary || \"{}\");\n\n          commitMessage = summary.CommitMessage;\n          break;\n        }\n        default:\n          break;\n      }\n    }\n\n    const subvalue = (\n      <>\n        {sourceRevision.revisionId?.substring(0, 6) || \"\"} - {commitMessage}\n      </>\n    );\n    return (\n      <SubvalueCell value={sourceRevision.actionName} subvalue={subvalue} />\n    );\n  }\n\n  return \"-\";\n};\n\nconst generatedColumns = (pipelineName: string, region: string) => {\n  return [\n    {\n      title: \"Execution\",\n      field: \"Pipeline\",\n\n      render: (row: Partial<PipelineExecutionSummary>) => {\n        if (row.pipelineExecutionId) {\n          return (\n            <>\n              <Link\n                href={`https://${region}.console.aws.amazon.com/codesuite/codepipeline/pipelines/${pipelineName}/executions/${row.pipelineExecutionId}/timeline?region=${region}`}\n                target=\"_blank\"\n              >\n                {row.pipelineExecutionId}\n              </Link>\n            </>\n          );\n        }\n        return <></>;\n      },\n    },\n    {\n      title: \"Last Run\",\n      field: \"\",\n      render: (row: Partial<PipelineExecutionSummary>) =>\n        `${formatTime(row.lastUpdateTime)} ago`,\n    },\n    {\n      title: \"Status\",\n      field: \"status\",\n      render: (row: Partial<PipelineExecutionSummary>) => {\n        if (row.status) {\n          return (\n            <Box display=\"flex\" alignItems=\"center\">\n              <PipelineStageStatus status={row?.status} />\n            </Box>\n          );\n        }\n        return <></>;\n      },\n    },\n    {\n      title: \"Source Revision\",\n      field: \"revisions\",\n      render: (row: Partial<PipelineExecutionSummary>) => renderTrigger(row),\n    },\n  ];\n};\n\ntype Props = {\n  entity: Entity;\n};\n\nexport const AWSCodePipelineExecutionsTable = ({ entity }: Props) => {\n  const { pipelineName, region, arn } = getCodePipelineArnFromEntity(entity);\n\n  const { loading, pipelineRunsSummaries, retry } =\n    useCodePipelineExecutions(arn);\n  return (\n    <Table\n      isLoading={loading}\n      actions={[\n        {\n          icon: () => <RetryIcon />,\n          tooltip: \"Refresh Data\",\n          isFreeAction: true,\n          onClick: () => retry(),\n        },\n      ]}\n      data={pipelineRunsSummaries ?? []}\n      title={\n        <Box display=\"flex\" alignItems=\"center\">\n          <Box mr={2} />\n          <Typography variant=\"h6\">AWS CodePipeline</Typography>\n        </Box>\n      }\n      columns={generatedColumns(pipelineName, region)}\n    />\n  );\n};\n","/**\n * Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\").\n * You may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *     http://www.apache.org/licenses/LICENSE-2.0\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from \"react\";\nimport { Grid } from \"@material-ui/core\";\nimport { AWSCodePipelineExecutionsTable } from \"../CodePipelineExecutionsTable\";\nimport { useEntity } from \"@backstage/plugin-catalog-react\";\n\nexport const AWSCodePipelineContent = () => {\n  const { entity } = useEntity();\n\n  return (\n    <Grid container spacing={3} direction=\"column\">\n      <Grid item>\n        <AWSCodePipelineExecutionsTable entity={entity} />\n      </Grid>\n    </Grid>\n  );\n};\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from \"react\";\nimport { Routes, Route } from \"react-router-dom\";\nimport { AWS_CODEPIPELINE_ARN_ANNOTATION } from \"../constants\";\nimport { useEntity } from \"@backstage/plugin-catalog-react\";\nimport { MissingAnnotationEmptyState } from \"@backstage/core-components\";\nimport { isAWSCodePipelineAvailable } from \"./Flags\";\nimport { AWSCodePipelineContent } from \"./CodePipelineContent\";\n\n/** @public */\nexport const Router = () => {\n  const { entity } = useEntity();\n\n  if (!isAWSCodePipelineAvailable(entity)) {\n    return (\n      <MissingAnnotationEmptyState\n        annotation={AWS_CODEPIPELINE_ARN_ANNOTATION}\n      />\n    );\n  }\n\n  return (\n    <Routes>\n      <Route path=\"/\" element={<AWSCodePipelineContent />} />\n    </Routes>\n  );\n};\n"],"names":[],"mappings":"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"}